---
name: flux-gen
description: Generate project-specific review agents from detected domain profiles
argument-hint: "[optional: domain name to generate for, or 'all' for all detected domains]"
---

# Flux-Gen — Domain-Specific Agent Generator

Generate project-specific `fd-*` review agents in `.claude/agents/` based on the project's detected domain profiles. These agents complement the core flux-drive plugin agents with deeper, domain-specific review expertise.

## Step 1: Detect Project Domains

Check for cached domain detection results:

```bash
cat {PROJECT_ROOT}/.claude/flux-drive.yaml 2>/dev/null
```

If no cache exists, run detection:

```bash
python3 ${CLAUDE_PLUGIN_ROOT}/scripts/detect-domains.py {PROJECT_ROOT} --json
```

If `$ARGUMENTS` specifies a domain name (e.g., `game-simulation`), use only that domain. If `$ARGUMENTS` is `all` or empty, use all detected domains.

If no domains detected and no argument provided, tell the user:
> No domains detected for this project. You can specify a domain manually: `/flux-gen game-simulation`

## Step 2: Load Agent Specifications

For each detected domain, read the domain profile:

```
${CLAUDE_PLUGIN_ROOT}/config/flux-drive/domains/{domain-name}.md
```

Extract the `## Agent Specifications` section. Each `### fd-{name}` subsection contains:
- **Focus**: one-line description of the agent's review area
- **Key review areas**: 5 bullet points defining what the agent checks

If the domain profile has no Agent Specifications section, skip it and note this to the user.

## Step 3: Check for Existing Agents

```bash
ls {PROJECT_ROOT}/.claude/agents/fd-*.md 2>/dev/null
```

For each agent to be generated:
- If the file already exists, **skip it** (don't overwrite user customizations)
- Present which agents exist vs which will be created

Use **AskUserQuestion** to confirm:
- Option 1: "Generate N new agents (skip M existing)" (Recommended)
- Option 2: "Regenerate all (overwrite existing)"
- Option 3: "Cancel"

## Step 4: Generate Agent Files

For each agent spec, create `.claude/agents/fd-{name}.md` using this template:

```markdown
# fd-{name} — {Domain} Domain Reviewer

> Generated by `/flux-gen` from the {domain-name} domain profile.
> Customize this file for your project's specific needs.

You are a project-specific flux-drive reviewer focused on **{Focus line}**.

## First Step (MANDATORY)

Check for project documentation:
1. `CLAUDE.md` in the project root
2. `AGENTS.md` in the project root
3. Any architecture or design docs referenced there

If docs exist, ground your review in the project's actual patterns and conventions.
If docs don't exist, apply general best practices for {domain-name} projects.

## Review Approach

### Key Review Areas

{For each bullet in Key review areas:}
- **{bullet}**: Examine this aspect carefully. Look for concrete evidence in the code or document. Flag specific issues with file paths and line numbers where possible.

### How to Review

1. **Read before judging** — understand the existing approach before suggesting changes
2. **Be specific** — reference actual files, functions, and line numbers
3. **Prioritize** — distinguish must-fix issues (P0/P1) from improvements
4. **Respect context** — the team may have intentional trade-offs you're not aware of

## Focus Rules

- Only flag issues within your domain ({Focus line})
- Don't duplicate findings that core fd-* agents would catch (architecture, safety, correctness, quality, performance, user-product)
- Keep recommendations actionable — suggest concrete changes, not abstract principles
- When uncertain, frame as a question rather than a finding
```

## Step 5: Create the Agents Directory

```bash
mkdir -p {PROJECT_ROOT}/.claude/agents
```

Then write each agent file using the Write tool.

## Step 6: Report

After generation, present a summary:

```
Generated {N} project-specific agents in .claude/agents/:

Domain: {domain-name} ({confidence})
  - fd-{name1}: {Focus line}
  - fd-{name2}: {Focus line}

Domain: {domain-name2} ({confidence})
  - fd-{name3}: {Focus line}

These agents will be included in flux-drive triage as Project Agents
(+1 category bonus). Customize them by editing the .md files directly.

To use them in a review: /flux-drive <target>
To regenerate: /flux-gen (existing agents are preserved unless you choose overwrite)
```

## Notes

- Generated agents use `subagent_type: general-purpose` in flux-drive (their full content is pasted as the system prompt)
- Project Agents get +1 category bonus in triage scoring
- Multiple domains may generate overlapping agents — flux-drive deduplication handles this (prefer Project > Plugin)
- Users should customize generated agents for their specific project needs
