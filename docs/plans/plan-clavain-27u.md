# Plan: Clavain-27u — Replace YAML frontmatter with Findings Index + findings.json

## Context
From 3-model debate consensus (Clavain-7p2 decision: Hybrid approach). Agents write rigid markdown, orchestrator generates structured data centrally.

## Changes

### 1. `skills/flux-drive/phases/launch.md` — Update prompt template
- Replace the `Required Output` section's YAML frontmatter requirement with a rigid markdown Findings Index pattern
- New agent output format:
  ```
  ### Findings Index
  - P0 | P0-1 | "Section Name" | Title of the issue
  - P1 | P1-1 | "Section Name" | Title
  - IMP | IMP-1 | "Section Name" | Title
  Verdict: safe|needs-changes|risky

  ### Summary
  ### Issues Found
  ### Improvements Suggested
  ### Overall Assessment
  ```
- Remove the YAML frontmatter block from the prompt template (lines 125-143)
- Keep the `.md.partial` → `.md` rename and `<!-- flux-drive:complete -->` marker (these are file-level completion signals, not output format)
- Update the "If you have zero findings" instruction to use the new format

### 2. `skills/flux-drive/phases/synthesize.md` — Replace YAML parsing with markdown parsing
- **Step 3.1**: Remove YAML validation entirely. Replace with Findings Index validation:
  - Check file starts with `### Findings Index`
  - Valid: Index lines match `- SEVERITY | ID | "Section" | Title` pattern
  - Malformed: No Findings Index or unrecognizable format → fall back to prose reading
  - Error: `verdict: error` (from stub files) → note as failed
- **Step 3.2**: Change "read YAML frontmatter first" to "read Findings Index first". The Index gives the same structured data (severity, section, title) without YAML parsing
- **Add Step 3.4a** (after Step 3.4, before Step 3.5): Generate `{OUTPUT_DIR}/findings.json` centrally:
  ```json
  {
    "reviewed": "YYYY-MM-DD",
    "agents": ["agent1", "agent2"],
    "findings": [
      {"id": "P0-1", "severity": "P0", "agent": "architecture-strategist", "section": "Section", "title": "...", "convergence": 3}
    ],
    "verdict": "needs-changes"
  }
  ```
  This is generated by the orchestrator from the collected Findings Indexes — NOT by agents.

### 3. `skills/clodex/templates/review-agent.md` — Update Codex template
- Replace the YAML frontmatter block in Phase 3 with the new Findings Index format
- Keep the same section structure (Summary, Issues Found, Improvements Suggested, Overall Assessment)

### 4. `skills/flux-drive/phases/launch-codex.md` — Update task description format
- The TIER field in the task description file becomes informational context only (not for YAML output)
- No YAML frontmatter reference in the dispatch section

## Acceptance Criteria
- No mention of "YAML frontmatter" in any flux-drive phase file
- Prompt template uses Findings Index format
- Synthesize phase parses Findings Index (not YAML)
- findings.json generated centrally in Step 3.4a
- review-agent.md Codex template matches new format
- `.md.partial` → `.md` rename mechanism unchanged
